!function(){"use strict";$(document).ready(function(){n.tinyPlayer.createPlayerFromTags()});var n={tinyPlayer:{Player:class{constructor(e){this._playlist=e,this._index=0,this._mouse_down=!1,this._seeking=!1,this._animation_timestamp=0,this.ns=n.tinyPlayer}play(e){var n=this;e="number"==typeof e?e:n._index,n._playlist[e].howl.play(),n._index=e}pause(e){e="number"==typeof e?e:this._index;e=this._playlist[e].howl;e&&e.pause()}stop(e){var n=this;e="number"==typeof e?e:n._index,n._playlist[e].howl.stop(),n._index=e}toggleTo(e){var n=this,t=n._playlist[n._index].howl;if(t.playing()){if(e===n._index)return void n.pause();t.stop()}n.play(e)}seek(e,n){var t=this.ns,i=this._playlist[e].howl,e=this._playlist[e].html_elem,n=n*i.duration();i.seek(n),e.find(".song-timer").html(t._formatTime(n)+" / "+t._formatTime(i.duration()))}updateDuration(e,n){this._playlist[e].html_elem.find(".song-progress").css("width",(100*n||0)+"%")}volume(n){Howler.volume(n);this._playlist.forEach(function(e){e.html_elem.find(".song-volume-bar#fg").css("width",60*n+"%"),e.html_elem.find(".song-volume-dot").css("left",60*n+20+"%")})}step(e){var n=this,t=this.ns,i=n._playlist[n._index].howl,o=n._playlist[n._index].html_elem,s=i.seek()||0;o.find(".song-timer").html(t._formatTime(s)+" / "+t._formatTime(i.duration())),n._seeking||n.updateDuration(n._index,s/i.duration());o.find(".song-title");i.playing()&&requestAnimationFrame(n.step.bind(n))}},createPlayerFromTags:function(){var o=this,s=[];$("audio.iru-tiny-player").each(function(){let e="";e=$(this).attr("data-title")?$(this).attr("data-title"):$(this).prevUntil("audio",":header").first().html();var n=!("none"===$(this).attr("preload")||"metadata"===$(this).attr("preload"));let t=[];$(this).children("source").each(function(){t.push($(this).attr("src"))});var i=o.createSongPlayer(e);s.push({title:e,files:t,html_elem:i,preload:n,howl:null}),$(this).after(i),$(this).hide()});var e=new o.Player(s);return o._setupEvents(e),e},createSongPlayer:function(e){return $("<div>").addClass("iru-tiny-player").append($("<div>").addClass("song-seek")).append($("<div>").addClass("song-progress")).append($("<div>").addClass("song-main-info").append($('<div class="icon fa-play">')).append($('<div class="icon fa-pause">').hide()).append($('<div class="icon fa-stop">')).append($('<div class="song-title">').html(e+"  ")).append($("<div>").addClass("song-timer")).append($('<div class="icon fa-volume-up">'))).append($("<div>").addClass("song-volume-control").hide().append($("<div>").addClass("song-volume-bar").attr("id","bg")).append($("<div>").addClass("song-volume-bar").attr("id","fg")).append($("<div>").addClass("song-volume-bar").attr("id","fgg")).append($("<div>").addClass("song-volume-dot")).append($("<div>").addClass("icon fa-times")))},_setupEvents:function(i){var o=this,s=0;i._playlist.forEach(function(e){var n=e.html_elem,t=s;e.howl=o._createHowlForPlayer(i,e),o._bindPlayerControls(i,n,t),++s})},_createHowlForPlayer:function(e,n){var t=n.html_elem,i=this;return new Howl({src:n.files,html5:!0,preload:n.preload,onplay:function(){t.find(".fa-play").hide(),t.find(".fa-pause").show(),requestAnimationFrame(e.step.bind(e))},onload:function(){t.find(".song-timer").html(i._formatTime(this.duration()))},onend:function(){t.find(".song-timer").html(i._formatTime(this.duration())),t.find(".song-progress").css("width","0%"),t.find(".song-title").html(n.title+"  "),t.find(".fa-pause").hide(),t.find(".fa-play").show()},onpause:function(){t.find(".fa-pause").hide(),t.find(".fa-play").show()},onstop:function(){t.find(".song-timer").html(i._formatTime(this.duration())),t.find(".song-progress").css("width","0%"),t.find(".song-title").html(n.title+"  "),t.find(".fa-pause").hide(),t.find(".fa-play").show()}})},_bindPlayerControls:function(t,i,n){i.find(".fa-play").click(function(){t.toggleTo(n)}),i.find(".fa-pause").click(function(){t.pause(n)}),i.find(".fa-stop").click(function(){t.stop(n)}),i.find(".fa-volume-up").click(function(){i.find(".song-volume-control").show()}),i.find(".fa-times").click(function(){i.find(".song-volume-control").hide()}),i.find(".song-volume-bar#fgg").click(function(e){var n=(n=e.pageX)-i.find(".song-volume-bar#bg").offset().left-7.5,e=parseFloat(i.find(".song-volume-bar#bg").innerWidth());t.volume(n/e)}),i.find(".song-volume-dot").mousedown(function(){t._mouse_down=!0}),i.find(".song-volume-control").mouseup(function(){t._mouse_down=!1}),i.find(".song-volume-control").mousemove(function(e){var n;t._mouse_down&&(n=(n=e.pageX)-i.find(".song-volume-bar#bg").offset().left-7.5,e=parseFloat(i.find(".song-volume-bar#bg").innerWidth()),e=Math.min(1,Math.max(0,n/e)),t.volume(e))});function o(e,n,t){return e=e.pageX,e-=n.find(t).offset().left,n=parseFloat(n.find(".song-seek").innerWidth()),Math.min(1,Math.max(0,e/n))}i.find(".song-seek").mousedown(function(e){t._seeking=!0,t.updateDuration(n,o(e,i,".song-seek"))}),i.find(".song-seek").mousemove(function(e){t._seeking&&t.updateDuration(n,o(e,i,".song-seek"))}),i.find(".song-seek").mouseup(function(){t._seeking=!1,t.seek(n,o(event,i,".song-seek"))}),i.find(".song-progress").mousedown(function(e){t._seeking=!0,t.updateDuration(n,o(e,i,".song-progress"))}),i.find(".song-progress").mousemove(function(e){t._seeking&&t.updateDuration(n,o(e,i,".song-progress"))}),i.find(".song-progress").mouseup(function(){t._seeking=!1,t.seek(o(n,event,i))})},_formatTime:function(e){var n=Math.floor(e/3600)||0,t=Math.floor((e-3600*n)/60)||0,e=Math.floor(e-60*t)||0;return 0<n?n+":"+(t<10?"0":"")+t+":"+(e<10?"0":"")+e:t+":"+(e<10?"0":"")+e}}};"object"==typeof exports&&(exports.Player=n.tinyPlayer.Player,exports.createPlayerFromTags=n.tinyPlayer.createPlayerFromTags,exports.createSongPlayer=n.tinyPlayer.createSongPlayer)}();