<!DOCTYPE html>
<html lang="vi">
<!-- Shift + Alt + F  để sắp xếp lại code ( format code )-->
<html>

<head>
    <!-- Tiêu đề trang -->
    <title>Nhật kí tình yêu</title>

    <!-- Bộ giải mã và phân loại thiết bị -->
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">

    <!-- Đảm bảo đặt meta tag sau -->
    <meta name="apple-mobile-web-app-status-bar-style" content="black">

    <meta name="apple-mobile-web-app-capable" content="yes">

    <!-- Biểu tượng cho web -->
    <link rel="icon" href="./Data/icon/Logo2.png" />

    <!-- Biểu tượng iPhone -->
    <link rel="apple-touch-icon" href="./Data/icon/Logo.png" sizes="150x150" />
    <!-- CSS của web -->
    <link rel="stylesheet" href="./Data/CSS/Style.css" />

    <!-- FontAweSome fas fa icon -->
    <script src="https://kit.fontawesome.com/9392097706.js" crossorigiln="anonymous"></script>
</head>
<body>
    <div class="rss-feed" id="rss-feed"></div>
</body>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
<script>ReloadBlog();
    function ReloadBlog() {
    
    const rssUrl1 = 'https://caunoihay.data.blog/feed/';
    const proxyUrl = 'https://api.codetabs.com/v1/proxy?quest=';
    
    
    fetch(proxyUrl + encodeURIComponent(rssUrl1))
      .then(response => response.text())
      .then(str => new DOMParser().parseFromString(str, "text/xml"))
      .then(data => {
        const items = data.querySelectorAll("item");
    
        let storyCount = 0;
        let storyHTML = '';
    
        items.forEach((item, index) => {
          storyCount++;
          const reverseIndex = items.length - index; // Tính chỉ số đếm ngược
          const storyId = `FeedID${reverseIndex}`; // Tạo id của div Feed
    
          
          const title = item.querySelector("title").textContent;
          const encoded = item.querySelector("encoded").textContent;
          const pubDate = item.querySelector("pubDate").textContent;
          const creator = item.querySelector("creator").textContent;
    
          const pubDateTimeStamp = Date.parse(pubDate);
          const nowTimeStamp = Date.now();
          const timeDiff = nowTimeStamp - pubDateTimeStamp;
    
          // Chuyển khoảng thời gian từ millisecond sang giây, phút, giờ hoặc ngày
          const secondDiff = Math.floor(timeDiff / 1000);
          const minuteDiff = Math.floor(timeDiff / (1000 * 60));
          const hourDiff = Math.floor(timeDiff / (1000 * 60 * 60));
          const dayDiff = Math.floor(timeDiff / (1000 * 60 * 60 * 24));
          let timeDiffText = '';
    
          var dateObj = new Date(pubDate);
          var daysOfWeek = ["Chủ Nhật", "Thứ hai", "Thứ ba", "Thứ tư", "Thứ năm", "Thứ sáu", "Thứ bảy"];
          var dayOfWeek = daysOfWeek[dateObj.getDay()];
          var day = dateObj.getDate();
          var month = dateObj.getMonth() + 1; // Tháng trong JavaScript bắt đầu từ 0, nên cần cộng thêm 1
          var year = dateObj.getFullYear();
    
          var formattedDate = dayOfWeek + ". " + day + "/" + month + "/" + year;
    
    
          if (dayDiff >= 365) {
            timeDiffText = formattedDate ;
          } else if (dayDiff > 0) {
            timeDiffText = dayDiff + " ngày trước";
          } else if (hourDiff > 0) {
            timeDiffText = hourDiff + " giờ trước";
          } else if (minuteDiff > 0) {
            timeDiffText = minuteDiff + " phút trước";
          } else {
            timeDiffText = "Vừa xong";
          }
    
          let author = '';
          let srcIMG = '';
         
    
    
          storyHTML += `
          <div class="Feed" id="${storyId}">
            <div class="Head">
                <div class="Author">
                    <div class="Avatar">
                        <img src="${srcIMG}" alt="${author}">
                    </div>
                    <div class="Info">                                                                             
                        <div class="Name">${author}</div>
                        <div class="Time">${timeDiffText}</div>
                    </div>
                    <div class="Func Share">
                    <i class="fa-solid fa-up-right-from-square"></i>
                  </div>
                </div>
            </div>
            
            <div class="Body">
                <div class="Status">
                    <h1>${title}</h1>
                    <div class="Content">${encoded}</div>
                </div>
            </div>
          </div>
          `;
        });
    
    
        document.querySelector('#rss-feed').innerHTML = storyHTML;
    
        // Lấy tất cả các div có lớp wp-block-video
        var videoDivs = document.querySelectorAll('.wp-block-video');
        // Lặp qua từng div và tìm thẻ video trong mỗi div
        videoDivs.forEach(function (videoDiv) {
          var video = videoDiv.querySelector('video');
          if (video) {
            video.setAttribute('webkit-playsinline', '');
            video.setAttribute('playsinline', '');
            video.removeAttribute('controls', ''); // Thêm thuộc tính controls nếu chưa có
          }
        });
    
    
        const videos = document.querySelectorAll('.wp-block-video video');
    
        videos.forEach(video => {
          video.addEventListener('click', function () {
            // Dừng tất cả các video khác
            videos.forEach(otherVideo => {
              if (otherVideo !== video) {
                otherVideo.pause();
              }
            });
            if (video.paused) {
              video.play();
            } else {
              video.pause();
            }
          });
        });    
    
      })
      .catch(error => console.log(error));
    }
    
    
</script>
</html>